doctype html
html(lang='en')

  head
    title xxx | xxx
    meta(name='description', content='xxx')
    meta(charset='utf-8')
    meta(name='viewport', content='width=device-width, initial-scale=1, shrink-to-fit=no')
    link(rel='shortcut icon', href='/favicon.ico', type='image/x-icon')
    meta(http-equiv='x-ua-compatible', content='ie=edge')
    link(href='//fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css' async)
    link(href='https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css' rel='stylesheet' type='text/css' async)

    style.

      body {
        font-family:'Roboto',sans-serif;
        box-sizing:border-box;
        background-color:white;
        padding:0px;
        margin:0px;
      }

      .left-pannel {
        border-right:1px solid #d7d8e1;
        box-sizing:border-box;
        width:100%;
      }

      .roladex-header {
        position:relative;
        padding:0px;
        margin:0px;
        width:100%;
      }

      .roladex-header-text {
        text-align:center;
        font-weight:600;
        font-size:2em;
        padding:22px;
        color:black;
        margin:0px;
      }

      .roladex-header-add-contact-button {
        background-color:transparent;
        border-radius:1em;
        position:absolute;
        line-height:2em;
        font-weight:300;
        cursor:pointer;
        font-size:2em;
        color:#1679f4;
        padding:0px;
        border:none;
        height:2em;
        width:2em;
        left:80%;
        top:6px;
      }

      .roladex-tab {
        border-bottom:3px solid gray;
        display:inline-block;
        cursor:pointer;
        width:50%;
      }

      .roladex-tab-selected {
        border-bottom:3px solid #1679f4;
        display:inline-block;
        cursor:pointer;
        width:50%;
      }

      .roladex-tab-text {
        text-align:center;
        font-size:1.2em;
        color:gray;
      }

      .roladex-tab-text-selected {
        text-align:center;
        font-size:1.2em;
        color:#1679f4;
      }


      .roladex-search-container {
        background-color:#fbfaff;
        position:relative;
        height:88px;
        width:100%;
      }

      .roladex-search-input {
        border: 1px solid #e4e0e1;
        width:calc(100% - 66px);
        border-radius:10px;
        margin-left:22px;
        text-indent:28px;
        margin-top:22px;
        font-size:1.2em;
        padding:11px;
      }

      .roladex-search-input-left-icon {
        position:absolute;
        cursor:default;
        color:#757575;
        left:35px;
        top:37px;
      }

      .roladex-search-input-right-icon {
        position:absolute;
        color:lightGray;
        cursor:pointer;
        right:35px;
        top:37px;
      }

      .contact-list-divider{
        background-color:#f3f3f3;
        padding-bottom:0.25em;
        box-sizing:border-box;
        padding-top:0.25em;
        padding-left:22px;
        font-size:1.5em;
        font-weight:700;
        color:#000;
        margin:0px;
        width:100%;
      }

      .contact-list-person-container {
        border-bottom:1px solid #f3f3f3;
        background-color:white;
        cursor:pointer;
        width:100%;
      }

      .contact-list-person-primary-text {
        display:inline-block;
        padding-left:22px;
        font-size:1.5em;
        font-weight:700;
      }

      .contact-list-person-secondary-text {
        display:inline-block;
        padding-left:8px;
        font-size:1.5em;
        font-weight:300;
      }

      .contact-card-container {
        border: 1px solid #d7d8e1;
        background-color:white;
        margin:7%;
        width:86%;
      }

      .right-pannel {
        display: none;
      }

      @media screen and (min-width: 768px) and (max-width: 1023px) {

        .left-pannel {
          box-sizing:border-box;
          overflow:scroll;
          height:100vh;
          float:left;
          width:50%;
        }

        .right-pannel {
          background-color:#e8ebf2;
          box-sizing:border-box;
          display: inline;
          overflow:scroll;
          font-size:1em;
          height:100vh;
          float:right;
          width:50%;
        }

        .contact-card-container {
          border: 1px solid #d7d8e1;
          width:calc(100% - 44px);
          background-color:white;
          margin:22px;
        }

        .contact-card-header {
          border-bottom:1px solid #f3f3f5;
          background:#fbfaff;
          cursor:default;
          padding:0px;
          width:100%;
          margin:0px;
        }

        .contact-card-header-left-button {
          padding-left:44px;
          padding-top:33px;
          font-size:1.25em;
          cursor:pointer;
          color:#1c7ef8;
          float:left;
          margin:0px;
        }

        .contact-card-header-right-button {
          padding-right:44px;
          padding-top:33px;
          font-size:1.25em;
          cursor:pointer;
          color:#1c7ef8;
          float:right;
          margin:0px;
        }

        .contact-card-name {
          text-align:center;
          padding-top:88px;
          font-size:2em;
          margin:0px;
        }

        .contact-card-last-updated {
          padding-bottom:11px;
          text-align:center;
          padding-top:5px;
          font-weight:300;
          font-size:1em;
          color:#808080;
          margin:0px;
        }

        .contact-card-action-container {
          justify-content: center;
          padding-bottom:44px;
          display: flex;
        }

        .contact-card-action-button {
          background-color:#1c7ef8;
          border-radius:2em;
          margin-left:14px;
          cursor:pointer;
          margin:22px;
          height:4em;
          width:4em;
        }

        .contact-card-action-icon {
          vertical-align:center;
          text-align:center;
          line-height:2em;
          color:white;
          height:100%;
          width:100%;
        }

        .contact-card-action-text {
          font-family:'Roboto',sans-serif;
          text-align:center;
          margin-top:10px;
          font-size:1em;
          cursor:default;
          color:#1c7ef8;
          padding:0px;
        }

        .contact-info-container {
          width:calc(50% + 60px);
          padding-bottom:22px;
          padding-left:55px;
          font-size:1.4em;
          padding-top:22px;
          cursor:default;
          margin:0px;
        }

        .contact-info-action-text {
          color:#3989e0;
          cursor:pointer;
        }

        .contact-info-divider {
          border: 1px solid #f3f3f5;
        }

        .contact-info-emergency-header {
          color:lightGray;
        }

        .contact-info-emergency-action-text {
          padding-bottom:22px;
          cursor:pointer;
          color:#fc3d39;
        }
      }





      @media screen and (min-width: 1024px) {

        .left-pannel {
          display: inline-block;
          box-sizing:border-box;
          overflow:scroll;
          height:100vh;
          float:left;
          width:30%;
        }

        .right-pannel {
          background-color:#e8ebf2;
          box-sizing:border-box;
          display: inline-block;
          overflow:scroll;
          font-size:1em;
          height:100vh;
          float:right;
          margin:0px;
          width:70%;
        }

        .contact-card-container {
          box-sizing:border-box;
          border: 1px solid #d7d8e1;
          margin:7%;
          width:86%;
        }

        .contact-card-header {
          border-bottom:1px solid #f3f3f5;
          box-sizing:border-box;
          background:#fbfaff;
          cursor:default;
        }

        .contact-card-header-left-button {
          padding-left:44px;
          padding-top:33px;
          font-size:1.5em;
          cursor:pointer;
          color:#1c7ef8;
          float:left;
          margin:0px;
        }

        .contact-card-header-right-button {
          padding-right:44px;
          padding-top:33px;
          font-size:1.5em;
          cursor:pointer;
          color:#1c7ef8;
          float:right;
          margin:0px;
        }

        .contact-card-name {
          text-align:center;
          padding-top:33px;
          font-size:3em;
          margin:0px;
        }

        .contact-card-last-updated {
          padding-bottom:11px;
          text-align:center;
          padding-top:5px;
          font-weight:300;
          font-size:1.25em;
          color:#808080;
          margin:0px;
        }

        .contact-card-action-container {
          justify-content: center;
          padding-bottom:44px;
          display: flex;
        }

        .contact-card-action-button {
          background-color:#1c7ef8;
          border-radius:2em;
          cursor:pointer;
          margin:22px;
          height:4em;
          width:4em;
        }

        .contact-card-action-icon {
          vertical-align:center;
          text-align:center;
          line-height:2em;
          color:white;
          height:100%;
          width:100%;
        }

        .contact-card-action-text {
          font-family:'Roboto',sans-serif;
          text-align:center;
          margin-top:10px;
          font-size:1.25em;
          cursor:default;
          color:#1c7ef8;
          padding:0px;
        }

        .contact-info-container {
          box-sizing:border-box;
          padding-left:55px;
          font-size:1.6em;
          cursor:default;
          margin:0px;
          width:86%;
        }

        .contact-info-action-text {
          color:#3989e0;
          cursor:pointer;
        }

        .contact-info-divider {
          border: 1px solid #f3f3f5;
        }

        .contact-info-emergency-header {
          color:lightGray;
        }

        .contact-info-emergency-action-text {
          padding-bottom:22px;
          cursor:pointer;
          color:#fc3d39;
        }
      }


  body

    //------
    //-ROLADEX PANNEL
    //-------
    div(class="left-pannel")


      //------
      //-HEADER
      //-------
      div(id="roladexHeader" class="roladex-header")
        button(id="roladexHeaderAddContactButton" class="roladex-header-add-contact-button") +
        p(id="roladexHeaderText" class="roladex-header-text") Contacts


      //------
      //-TABS
      //-------
      if sortPrimary === 'givenName'
        div(id="roladexTabsGivenName" class="roladex-tab-selected" onclick="window.location.href='/?sort=givenName'")
          p(id="roladexTabsGivenNameText" class="roladex-tab-text-selected") First Name
        div(id="roladexTabsFamilyName" class="roladex-tab" onclick="window.location.href='/?sort=familyName'")
          p(id="roladexTabsFamilyNameText" class="roladex-tab-text") Last Name
      if sortPrimary === 'familyName'
        div(id="roladexTabsGivenName" class="roladex-tab" onclick="window.location.href='/?sort=givenName'")
          p(id="roladexTabsGivenNameText" class="roladex-tab-text") First Name
        div(id="roladexTabsFamilyName" class="roladex-tab-selected" onclick="window.location.href='/?sort=familyName'")
          p(id="roladexTabsFamilyNameText" class="roladex-tab-text-selected") Last Name


      //------
      //-SEARCH
      //-------
      div(id="roladexSearchContainer" class="roladex-search-container")
        span(id="roladexSearchInputLeftIcon" class="roladex-search-input-left-icon fa fa-search" aria-hidden="true")
        input(id="roladexSearchInput" class="roladex-search-input" placeholder="Search")
        span(id="roladexSearchInputRightIcon" class="roladex-search-input-right-icon fa fa-times-circle" aria-hidden="true")


      //------
      //-LIST
      //-------
      div(id='contactListContainer' class="contact-list-container")
        each person in people
          - let firstLetter = person[sortPrimary].charAt(0).toUpperCase();
          if alphabet.includes(firstLetter)
            - let charIndex = alphabet.indexOf(firstLetter);
            - let char = alphabet.splice(charIndex, 1);
            - alphabet = alphabet.filter(item => item !== char)
            //-DIVIDER
            p(id="contactListDivider" class="contact-list-divider") #{char}
          div(id=person._id class="contact-list-person-container")
            span
              if sortPrimary === 'givenName'
                p(id="contactListPersonPrimaryText" class="contact-list-person-primary-text") #{person[sortPrimary]}
                p(id="contactListPersonSecondaryText" class="contact-list-person-secondary-text") #{person[sortSecondary]}
              if sortPrimary === 'familyName'
                p(id="contactListPersonPrimaryText" class="contact-list-person-primary-text") #{person[sortPrimary]},
                p(id="contactListPersonSecondaryText" class="contact-list-person-secondary-text") #{person[sortSecondary]}

      div(id='searchResultListContainer' hidden)


    //------
    //-CARD CONTAINER
    //-------
    - let contact = people[0];
    div(class="right-pannel")
      //------
      //-CONTACT CARD
      //-------
      div(id="contactCardContainer" class="contact-card-container")
        ////////
        //HEADER
        /////////
        div(id="contactCardHeader" class="contact-card-header")
          p(id="contactCardHeaderLeftButton" class="contact-card-header-left-button") Done
          p(id="contactCardHeaderRightButton" class="contact-card-header-right-button") Edit
          if sortPrimary === 'givenName'
            h1(id="contactCardName" class="contact-card-name") #{people[0][sortPrimary]} #{people[0][sortSecondary]}
          if sortPrimary === 'familyName'
            h1(id="contactCardName" class="contact-card-name") #{people[0][sortPrimary]}, #{people[0][sortSecondary]}
          p(id="contactCardLastUpdated" class="contact-card-last-updated") Updated 3 days ago
          /////////
          //ACTIONS
          /////////
          div(id="contactCardActionContainer" class="contact-card-action-container")
            div(id="contactCardPhoneButton" class="contact-card-action-button")
              span(id="contactCardPhoneIcon" class="contact-card-action-icon fa fa-phone fa-2x")
              p(id="contactCardPhoneText" class="contact-card-action-text") home
            div(id="contactCardEmailButton" class="contact-card-action-button")
              span(id="contactCardEmailIcon" class="contact-card-action-icon fa fa-envelope fa-2x")
              p(id="contactCardPhoneText" class="contact-card-action-text") email
        /////////
        //INFO
        /////////
        div(id="contactInfoContainer" class="contact-info-container")
          p email:
          p(id="contactInfoEmailText" class="contact-info-action-text") jose@barrios.io
          div(class="contact-info-divider")
          p phone:
          p(id="contactInfoPhoneText" class="contact-info-action-text") +1 (250) 588-8968
          div(class="contact-info-divider")
          p(class="contact-info-emergency-header") Emergency Contacts:
          p Camille Graham
          p(class="contact-info-emergency-action-text") +1 (555) 555-5555


script.
  var alphabet = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z'];
  var sortPrimary = !{JSON.stringify(sortPrimary)}
  var sortSecondary = !{JSON.stringify(sortSecondary)}
  var people = !{JSON.stringify(people)}
  var searchQuery = !{JSON.stringify(search)}
  var person = document.querySelector('.contact-list-person-container');
  var contactListDivider = document.querySelector('#contactListDivider');
  var searchInput = document.querySelector('#roladexSearchInput');
  var deleteQueryButton = document.querySelector('#roladexSearchInputRightIcon');
  var allResultsContainer = document.querySelector('#contactListContainer');
  var filteredResultsContainer = document.querySelector('#searchResultListContainer');

  var search = function(query, people) {
    let found = [];
    people.forEach(person => {
      var givenName = person.givenName.toLowerCase();
      var familyName = person.familyName.toLowerCase();
      query = query.toLowerCase();
      let fullName = `${givenName} ${familyName}`;
      if(fullName.includes(query)){
        found.push(person)
      }
    })
    return found;
  }


  var renderSearchResults = function(results){
    if(results.length){
      let newAlphabet = alphabet.slice(0);
      results.forEach(result => {
        let firstLetter = result[sortPrimary].charAt(0).toUpperCase();
        if(newAlphabet.includes(firstLetter)){
          let charIndex = newAlphabet.indexOf(firstLetter);
          let char = newAlphabet.splice(charIndex, 1);
          newAlphabet = newAlphabet.filter(item => item !== char)
          let divider = contactListDivider.cloneNode(true);
          divider.innerHTML = firstLetter.toUpperCase();
          filteredResultsContainer.appendChild(divider);
        }

        let personClone = person.cloneNode(true);
        personClone.id = result.id;
        //Adds comma if primary listing is last name, nothing otherwise
        let comma = sortPrimary === 'familyName'? ',' : '';
        personClone.querySelector('#contactListPersonPrimaryText').innerHTML = result[sortPrimary] + comma;
        personClone.querySelector('#contactListPersonSecondaryText').innerHTML = result[sortSecondary];
        filteredResultsContainer.appendChild(personClone);
      })
    }
    else {
      let personClone = person.cloneNode(true);
      personClone.querySelector('#contactListPersonPrimaryText').innerHTML = 'None Found';
      personClone.querySelector('#contactListPersonSecondaryText').innerHTML = '';
      personClone.style.textAlign = 'center';
      personClone.style.backgroundColor = '#fbfaff';
      personClone.style.color = '#808080';
      filteredResultsContainer.appendChild(personClone);
    }
  }


  ////////////////////////////////////////////////////////////////
  //
  // USER INPUT
  //
  ///////////////////////////////////////////////////////////////////


  //DELETE SEARCH INPUT
  deleteQueryButton.addEventListener('click', function(e){
    searchInput.value = '';
    var event = document.createEvent('Event');
    event.initEvent('input', true, true);
    searchInput.dispatchEvent(event);
  })

  //SEARCH INPUT
  searchInput.addEventListener('input', function(e){
    filteredResultsContainer.innerHTML = '';
    if(e.target.value){
      allResultsContainer.style.display = 'none';
      filteredResultsContainer.style.display = 'initial';
    } else{
      allResultsContainer.style.display = 'initial';
      filteredResultsContainer.style.display = 'none';
    }
    let query = e.target.value;
    let results = search(query, people);
    renderSearchResults(results);
  })

  if(searchQuery){
    searchInput.value = searchQuery;
    var event = document.createEvent('Event');
    event.initEvent('input', true, true);
    searchInput.dispatchEvent(event);
  }
